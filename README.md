# cfg

<a href="https://www.npmjs.com/package/@smpx/cfg"><img src="https://img.shields.io/npm/v/@smpx/cfg.svg" alt="Version"></a>
<a href="https://www.npmjs.com/package/@smpx/cfg"><img src="https://img.shields.io/npm/dm/@smpx/cfg.svg" alt="Downloads"></a>
<a href="https://www.npmjs.com/package/@smpx/cfg"><img src="https://img.shields.io/npm/l/@smpx/cfg.svg" alt="License"></a>
<a href="https://david-dm.org/smartprix/cfg"><img src="https://david-dm.org/smartprix/cfg/status.svg" alt="Dependencies"></a>
<a href="https://david-dm.org/smartprix/cfg?type=dev"><img src="https://david-dm.org/smartprix/cfg/dev-status.svg" alt="Dev Dependencies"></a>


Configuration management for node.js.

Example config:

```js
// config.js
module.exports = {
    db: {
        password: 'abcde',
        host: '127.0.0.1',
    },
    port: 3000,
    hosts: ['127.0.0.1'],
    logsDir: `${__dirname}/logs`,

    $env_production: {
        port: 80,
        logsDir: '/home/app/logs',
    },

    $env_test: {
        port: 5000,
    },

    $env_CI: {
        db: {
            // Docker image hostname
            host: 'postgresql',
        },
    },
};
```

Usage:

```js
const cfg = require('@smpx/cfg');

const dbConf = cfg('db'); // { password: 'abcde', host: '127.0.0.1' }
const dbPassword = cfg('db.password');

```

## Docs

It reads values from `config.js` file from project directory, but they can be overwritten with another `config.js` in the `private` folder in the project directory. Or through env vars in this format:

```sh
# Overwriting password (db.password):
CFG__DB__PASSWORD='password' yarn start
# Adding host to posiition 1 (hosts.1):
CFG__HOSTS_1='new-host.region.rds.amazonaws.com' yarn start
```

> NOTE: ENV VARS override might only work with camelCase keys

It basically uses lodash.set internally. The path is generated by removing the `CFG__` prefix and replacing `__` with `.` and converting each word in between to camelCase (also through lodash).

### NODE_ENV & CI overrides

cfg also allows overriding config according to NODE_ENV or CI environment variables. For example if NODE_ENV="production", then if a `$env_production` key exists it's value gets merged over existing conf (this happens before merging any `private/config.js` file).

Similarly in CI environments, the value in `$env_CI` is merged.

## API

Please check out the typescript definition file: [index.d.ts](./index.d.ts) for a overwview of all the functions provided.

## CLI

Get a value from cfg.js

```sh
# Installed globally
cfg get redis.port
cfg get logsDir

# See how ENV_VAR will override config
CFG__DB__PASSWORD='password' cfg get "db.password"

# Through npx or yarn (when installed locally)
npx cfg get redis.port
yarn cfg get logsDir

```
