# cfg

<a href="https://www.npmjs.com/package/@smpx/cfg"><img src="https://img.shields.io/npm/v/@smpx/cfg.svg" alt="Version"></a>
<a href="https://www.npmjs.com/package/@smpx/cfg"><img src="https://img.shields.io/npm/dm/@smpx/cfg.svg" alt="Downloads"></a>
<a href="https://www.npmjs.com/package/@smpx/cfg"><img src="https://img.shields.io/npm/l/@smpx/cfg.svg" alt="License"></a>
<a href="https://david-dm.org/smartprix/cfg"><img src="https://david-dm.org/smartprix/cfg/status.svg" alt="Dependencies"></a>
<a href="https://david-dm.org/smartprix/cfg?type=dev"><img src="https://david-dm.org/smartprix/cfg/dev-status.svg" alt="Dev Dependencies"></a>


Configuration management for node.js.

## Usage:

### Example config:

```js
// config.js
module.exports = {
    db: {
        password: 'abcde',
        host: '127.0.0.1',
    },
    port: 3000,
    hosts: ['127.0.0.1'],
    logsDir: `${__dirname}/logs`,

    $env_production: {
        port: 80,
        logsDir: '/home/app/logs',
    },

    $env_test: {
        port: 5000,
    },

    $env_CI: {
        db: {
            // Docker image hostname
            host: 'postgresql',
        },
    },
};
```

### Programmatic Usage

```js
// index.js
const cfg = require('@smpx/cfg');

const dbConf = cfg('db'); // { password: 'abcde', host: '127.0.0.1' }
const dbPassword = cfg('db.password'); // 'abcde'
const hosts = cfg('hosts'); // ['127.0.0.1']
const port = cfg('port') // 3000

```

## Docs

The module reads values from a `config.js` file from project directory and overwrites them according to environment overrides or through private files. Values can be overwritten with another `config.js` in the `private` folder (supposed to be added in `.gitignore` for secrets) in the project directory or through env vars in this format:

```sh
# Overwriting password (db.password):
CFG__DB__PASSWORD='password' node index.js
# `dbPassword` variable will now have value 'password'

# For arrays: Adding host to position 1 (hosts.1):
CFG__HOSTS__1='new-host.region.rds.amazonaws.com' node index.js
```

> NOTE: ENV VARS override might only work with camelCase keys

It basically uses lodash.set internally. The path is generated by removing the `CFG__` prefix and replacing `__` with `.` and converting each word in between to camelCase (also through lodash).

### NODE_ENV & CI overrides

The module also allows overriding config according to NODE_ENV or CI environment variables. For example if `NODE_ENV="production"`, then if a `$env_production` key exists it's value gets merged over existing conf (this happens before merging any `private/config.js` file).

Similarly in CI environments, the value in `$env_CI` is merged over the whole config object.

Considering the [example above](#usage) and running it with `NODE_ENV=test` the port variable will have a value of `5000` as `$env_test` gets merged over whole config.

### Merge Strategy

The merge is done recursively until the value for a key in the config object is not a plain object, then it gets replaced whole with the overwriting value. Note: Arrays do not get merged but get replaced.

## API

Please check out the typescript definition file: [index.d.ts](./index.d.ts) for an overview of all the functions provided.

## CLI

Get a value from cfg.js

```sh
# Installed globally
cfg get port
cfg get logsDir

# See how ENV_VAR will override config
CFG__DB__PASSWORD='password' cfg get "db.password"

# Through npx or yarn (when installed locally)
npx cfg get port
yarn cfg get logsDir

```
